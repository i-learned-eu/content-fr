Title: OpenSSL, itinÃ©raire dâ€™une catastrophe ratÃ©e
Date: 2022-11-01
lang: fr
Authors: Eban, elmar 
Keywords: cybersÃ©curitÃ©, openssl
Slug: openssl-vulnerability
Summary: Le 25 octobre 2022, lâ€™Ã©quipe du projet OpenSSL dÃ©voile la publication Ã  venir dâ€™une nouvelle version de leur librairie de cryptographie, la version 3.0.7 qui colmaterait une faille de sÃ©vÃ©ritÃ© classÃ©e Critical. Un niveau de criticitÃ© atteint trÃ¨s rarement et qui, Ã  juste titre (ou pas ğŸ˜‰), a immÃ©diatement inquiÃ©tÃ© la communautÃ© de la cybersÃ©curitÃ©. Dans cet article, nous dÃ©taillerons quelles sont les machines vulnÃ©rables, le fonctionnement de cette faille de sÃ©curitÃ©, et verront comment sâ€™en protÃ©ger.
Category: CybersÃ©curitÃ©

Le 25 octobre 2022, lâ€™Ã©quipe du projet OpenSSL dÃ©voile la publication Ã  venir dâ€™une nouvelle version de leur librairie de cryptographie, la version 3.0.7 qui colmaterait une faille de sÃ©vÃ©ritÃ© classÃ©e `Critical`. Un niveau de criticitÃ© atteint trÃ¨s rarement et qui, Ã  juste titre (ou pas ğŸ˜‰), a immÃ©diatement inquiÃ©tÃ© la communautÃ© de la cybersÃ©curitÃ©. Dans cet article, nous dÃ©taillerons quelles sont les machines vulnÃ©rables, le fonctionnement de cette faille de sÃ©curitÃ©, et verront comment sâ€™en protÃ©ger.

*La premiÃ¨re version de cet article est paru une heure aprÃ¨s lâ€™annonce de la vulnÃ©rabilitÃ©, il sera mis Ã  jour au fur et Ã  mesure que de nouvelles informations sont publiÃ©es.*

# ğŸ¯ Machines vulnÃ©rables

Il est Ã  noter que beaucoup de serveurs ne sont pas vulnÃ©rables Ã  cette nouvelle vulnÃ©rabilitÃ©, car elle concerne toutes les versions supÃ©rieures Ã  la version 3, version qui est assez rÃ©cente et donc peu dÃ©ployÃ©e Ã  ce jour. Cependant, la majoritÃ© des distributions majeures telles qu'Ubuntu, CentOS et Fedora sont vulnÃ©rables sur leurs derniÃ¨res versions.

![List os vulnÃ©rable](/static/img/openssl-vulnerability/os.webp)

Au-delÃ  du paquet `openssl` inclut dans les distributions, de nombreux logiciels embarquent aussi OpenSSL, il ne faut ainsi pas nÃ©gliger cette vulnÃ©rabilitÃ© mÃªme si vous nâ€™utilisez pas une distribution vulnÃ©rable. Si vous souhaitez en savoir plus, il y a ce [dÃ©pÃ´t git](https://github.com/NCSC-NL/OpenSSL-2022) qui contient une liste (non exhaustive) des logiciels impactÃ©s.

# ğŸ¦  La faille

La vulnÃ©rabilitÃ© qui a Ã©tÃ© dÃ©voilÃ©e permet avec un certificat x509 dâ€™avoir un DoS, ou dans certains cas (qui semble improbable) une RCE. DoS, pour Denial of Service, câ€™est une vulnÃ©rabilitÃ© qui permet de faire planter le service. RCE, pour Remote Code Execution, câ€™est une vulnÃ©rabilitÃ© qui comme son nom lâ€™indique permet dâ€™exÃ©cuter du code Ã  distance.

Cette faille est rendue possible grÃ¢ce Ã  un bug de mÃ©moire, un buffer overflow. Le buffer est lâ€™espace de la mÃ©moire allouÃ© par le processus pour stocker des donnÃ©es, cet espace est limitÃ© en taille Ã  un certain nombre de bits. Dans certains cas le programme peu Ã©crire en mÃ©moire plus de donnÃ©e que ce qui Ã©tait prÃ©vue Ã  lâ€™origine. Il y a alors un dÃ©passement (overflow). Ã‡a peut permettre Ã  un attaquant dâ€™Ã©crire en mÃ©moire Ã  des endroits oÃ¹ il nâ€™est pas censÃ© pouvoir le faire, et donc, par exemple, de forcer le systÃ¨me Ã  exÃ©cuter du code, en mettant Ã  lâ€™emplacement oÃ¹ on devrait trouver du code bÃ©nin un exploit.

![SchÃ©ma buffer overflow](/static/img/openssl-vulnerability/buffer_overflow.webp)

Câ€™est dans la fonction qui dÃ©code le punycode, format utilisÃ© pour avoir de lâ€™Unicode dans les noms de domaines, que le buffer overflow a lâ€™air dâ€™avoir fait son apparition. Pour exploiter la vulnÃ©rabilitÃ©, un attaquant doit construire un certificat x509 malicieux. Du peu de dÃ©tail que fournit OpenSSL, le buffer overflow a lâ€™air plus prÃ©cisÃ©ment dans le dÃ©codage dâ€™un potentiel mail, qui si on met un nombre arbitraire de `.` cause le buffer overflow. Le certificat doit Ãªtre validÃ© par une autoritÃ© de certification reconnue par la machine. Cette derniÃ¨re condition permet de rÃ©duire grandement lâ€™impact quâ€™aura cette vulnÃ©rabilitÃ©, cette faille nâ€™est pas le â€œnouveau [Heartbleed](https://heartbleed.com/)â€ comme certainÂ·eÂ·s lâ€™attendait.

Update : Deux proof-of-concept d'exploitation de cette faille ont Ã©tÃ© publiÃ©s, un par [colmmacc](https://github.com/colmmacc/CVE-2022-3602) et l'autre par [christophetd](https://github.com/DataDog/security-labs-pocs/tree/main/proof-of-concept-exploits/openssl-punycode-vulnerability) !

# ğŸ§‘â€ğŸš’ Mitiger

CÃ´tÃ© Ã©diteur, OpenSSL aurait pu prendre certaines mesures nÃ©cessaires afin de permettre de dÃ©tecter cette vulnÃ©rabilitÃ© en amont, notamment en mettant en place du fuzzing de faÃ§on plus avancÃ©. OpenSSL le fait dÃ©jÃ  de leur cÃ´tÃ©, et Google le fait aussi pour nombre de projets open source dont OpenSSL, mais peut-Ãªtre que ces processus nâ€™ont pas Ã©tÃ© implÃ©mentÃ©s de maniÃ¨re assez approfondie.

CÃ´tÃ© utilisateur, pour pallier ce problÃ¨me de sÃ©curitÃ©, pas de mystÃ¨re, il faut mettre Ã  jour. Mettre Ã  jour non seulement le paquet `openssl` et la librairie associÃ©e (`libssl`), mais aussi les paquets qui en dÃ©pendent de maniÃ¨re â€œ[statique](https://en.wikipedia.org/wiki/Static_library)â€, comme `Node.js` qui est vulnÃ©rable pour les versions supÃ©rieures Ã  la version 18. `Docker` nâ€™est aussi pas Ã  nÃ©gliger, lâ€™entreprise estime que prÃ¨s de 1000 images de conteneurs sur sa plateforme Docker Hub sont vulnÃ©rables. Docker met Ã  disposition un outil appelÃ© [docker-index](https://github.com/docker/index-cli-plugin) qui permet avec la commande `docker-index CVE --image IMAGE DSA-2022â€“0001` de tester si certaines de vos images sont vulnÃ©rables. Comme toujours, il est important de mettre en place des mises Ã  jour de sÃ©curitÃ© automatiques pour Ã©viter ce genre de dÃ©sagrÃ©ments, avec, par exemple, [UnattendedUpgrades](https://wiki.debian.org/UnattendedUpgrades) sous Debian et dÃ©rivÃ©s, fonctionnalitÃ© aussi possible sous [Fedora](https://fedoraproject.org/wiki/AutoUpdates), CentOS et RHEL. Une fonctionnalitÃ© similaire est aussi disponible pour Docker grÃ¢ce au projet [Watchtower](https://hub.docker.com/r/containrrr/watchtower/) !

# ğŸ“‘ Conclusion

MalgrÃ© la nÃ©cessitÃ© Ã©vidente de patcher cette vulnÃ©rabilitÃ©, il nâ€™y a pas lieu de sâ€™affoler. Des experts du domaine tels que *[Pwn All The Things](https://twitter.com/pwnallthethings/status/1587486661319049216)* ou encore [*Marcus Hutchins](https://twitter.com/MalwareTechBlog)* (malwaretechblog) ont tempÃ©rÃ© en disant que cette faille nâ€™Ã©tait pas si terrible quâ€™attendue.

# ğŸ“ Sources

- [https://www.openssl.org/news/secadv/20221101.txt](https://www.openssl.org/news/secadv/20221101.txt)
- [https://www.openssl.org/blog/blog/2022/11/01/email-address-overflows/](https://www.openssl.org/blog/blog/2022/11/01/email-address-overflows/)
